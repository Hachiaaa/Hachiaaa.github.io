---
layout: post
title: "ç®€åŒ–ç‰ˆVuexå®ç°"
date: 2020-11-21
sitemap: false
keywords: "blog"
description: "ğŸš€"
---

Vuexæ ¸å¿ƒåŸç†è§£æ

> Vuexæ˜¯ä¸€ä¸ªçŠ¶æ€ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼redux  
> Vuexæœ‰å››ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œstateï¼Œgettersï¼Œmutationsï¼Œactionsã€‚gettersç±»ä¼¼vueé‡Œçš„è®¡ç®—å±æ€§ï¼Œmutationsæ˜¯å”¯ä¸€å¯ä»¥ä¿®æ”¹stateçš„åœ°æ–¹ï¼Œactionså¯ä»¥æ´¾å‘å¤šä¸ªmutationsï¼Œå¯ä»¥æœ‰å¼‚æ­¥æ“ä½œï¼Œå¯å®šåˆ¶åŒ–è¾ƒé«˜ã€‚  
> Vuexä»¥æ’ä»¶å½¢å¼å‘å¸ƒï¼Œå¯¹å¤–æš´éœ²ä¸€ä¸ªinstallæ–¹æ³•

```javascript
function forEachValue(obj,fn){
    Object.keys(obj).forEach(key=>fn(obj[key],key))
}

function registerGetter(store,getterName,getterFn){
    Object.defineProperty(store.getters,getterName,{
        //getteræ˜¯åªè¯»å±æ€§
        get:()=>{
            return getterFn(store.state)
        }
    })
}

function registerAction(store,actionName,actionFn){
    store.actions[actionName]=()=>{
        actionFn.call(store,store)
    }
}

function registerMutation(store,mutationName,mutationFn){
    store.mutations[mutationName]=()=>{
        mutationFn.call(store,store.state)
    }
}


class Store{
    constructor(options={},Vue){
        //storeå¯¹è±¡çš„options(åŒ…æ‹¬stateï¼Œgettersï¼Œmutationsï¼Œactions)
        this.options=options
        this.getters={}
        this.mutations={}
        this.actions={}
        //æ³¨å†Œæ¯ä¸€ä¸ªgetter
        forEachValue(options.getters,(getterFn,getterName)=>{
            registerGetter(this,getterName,getterFn)
        })
        //æ³¨å†Œæ¯ä¸€ä¸ªmutation
        forEachValue(options.mutations,(mutationFn,mutationName)=>{
            registerMutation(this,mutationName,mutationFn)
        })
        //æ³¨å†Œæ¯ä¸€ä¸ªaction
        forEachValue(options.actions,(actionFn,actionName)=>{
            registerAction(this,actionName,actionFn)
        })
        //å°†stateçš„æ•°æ®æ”¾åˆ°vueå“åº”å¼é‡Œï¼Œå¦‚æœæœ‰æ•°æ®çš„å˜æ›´ä¼šè§¦å‘è§†å›¾render
        this._vm=new Vue({
            data:{
                state:options.state
            }
        })
    }
    //å¯¹å¤–æ˜¯åªè¯»å±æ€§ä¸”æ˜¯å“åº”å¼
    get state(){
        return this._vm.$data.state
    }
    commit(type){
        this.mutations[type]()
    }
    dispatch(type){
        return this.actions[type]()
    }
}
//å¯¹å¤–æš´éœ²installæ–¹æ³•ï¼Œæ³¨å†Œä¸€ä¸ªå…¨å±€çš„mixin
//åœ¨beforeCreateé’©å­ä¸­æ³¨å†Œ$storeå±æ€§ï¼Œä½¿å¾—æ‰€æœ‰ç»„ä»¶éƒ½èƒ½æ‹¿åˆ°$store
function install(Vue){
    Vue.mixin({
        beforeCreate(){
            const options=this.$options
            if(options.store){
                //ç»„ä»¶å†…éƒ¨æœ‰storeåˆ™ä¼˜å…ˆä½¿ç”¨ç»„ä»¶å†…éƒ¨çš„store
                this.$store=options.store
            }else if(options.parent && options.parent.$store){
                //ç»„ä»¶å†…éƒ¨æ²¡æœ‰storeï¼Œä»æ ¹ç»„ä»¶ç»§æ‰¿
                this.$store=options.parent.$store
            }
        }
    })
}
//å¯¼å‡º
export default{
    Store,
    install
}
//ä½¿ç”¨
Vue.use(Vuex)
new Vuex.Store({
    state:{},
    getters:{},
    mutations:{},
    actions:{}
})
```