---
layout: post
title: "node.jsçˆ¬å–å¤è¯—æ–‡ç½‘"
date: 2020-11-06
sitemap: false
keywords: "blog"
description: "ğŸš€"
---

nodejsçˆ¬è™«è¯•æ°´

## node.jsçˆ¬è™«
* node.jsçš„çˆ¬è™«ä¸»è¦ç”¨httpåº“ï¼Œæˆ–è€…httpsåº“æ¥æ¨¡æ‹Ÿå®¢æˆ·ç«¯è¿›è¡Œç½‘é¡µæŠ“å–
* å¾…æŠ“å–ç½‘ç«™`https://so.gushiwen.org`ï¼Œç”±äºè¯¥ç½‘ç«™åªå…è®¸æŠ“å–å‰10é¡µå†…å®¹ï¼Œæ‰€ä»¥å…ˆæŠ“å–ä½œè€…é¡µçš„å‰åé¡µï¼Œä¹‹åæŠ“å–æ¯ä¸ªä½œè€…çš„å‰åé¡µè¯—è¯(æ¯é¡µåé¦–)ï¼Œæ€»å…±å¤§æ¦‚ä¸€ä¸‡æ¡ï¼Œå¹¶ä¿å­˜åˆ°æ–‡æœ¬æ–‡æ¡£ã€‚
* ç”¨åˆ°çš„åº“æœ‰ï¼Œ`fs` | `https` | `cheerio`ï¼Œcheerioæ˜¯nodeç«¯çš„jquery.

ä¸‹é¢ç›´æ¥ä¸Šä»£ç 

é¦–å…ˆæ ¹æ®ä½œè€…é¡µçš„é¡µç æŠ“å–å•ä¸ªä½œè€…çš„è¯—è¯é¡µé¢ï¼š   
```javascript
async function getAuthor(page){
        let fuckingauthorlist=[]
        fuckingauthorlist=await new Promise((resolve,reject)=>{
            https.get(`https://so.gushiwen.org/authors/default.aspx?p=${page}&c=`,(res)=>{
                let result=""
                res.on('data',(chunk)=>{
                    result+=chunk
                })
                res.on('end',()=>{
                    const $ =cheerio.load(result)
                    let authorlist=$('body > div.main3 > div.left > div.sonspic > div.cont > p:nth-child(3) > a')
                    let anchorlist=[]
                    for(let a in authorlist){
                        let anchor=authorlist[a].attribs
                        if((anchor!==undefined)&&(Object.keys(anchor).length!==0))anchorlist.push(anchor)
                    }
                    fuckingauthorlist=anchorlist.map((item,index)=>{
                        return item.href
                    })
                    resolve(fuckingauthorlist)
                })
            })
        })
        return fuckingauthorlist
       
}
````

ç„¶åè·å–å‰åé¡µä½œè€…çš„è¯—è¯é¡µé¢ï¼Œè¿™é‡Œè¦å°†å¾ªç¯æ”¾åœ¨å¼‚æ­¥å®¹å™¨é‡Œé¢ï¼Œç›´æ¥å®šä¹‰ä¸€ä¸ªasync å‡½æ•°
```javascript
async function getAllAuthor(){
    let authorlist=[]
    for(let i=0;i<10;i++){
        let a=await getAuthor(i+1)
        authorlist.push(...a)
    }
    authorlist=authorlist.map((item)=>{
        return 'https://so.gushiwen.org'+item
    })
    return authorlist 
}
```

ç„¶åæˆ‘ä»¬æ‹¿åˆ°äº†æ‰€æœ‰ä½œè€…è¯—æ­Œé¡µé¢çš„é¦–ä¸ªé“¾æ¥ï¼Œå…ˆå®šä¹‰æŠ“å–ç¬¬ä¸€é¡µçš„æ•°æ®
```javascript
async function writeContent(url){  
    await new Promise((resolve,reject)=>{
    https.get(url,(res)=>{
        let result=''
        res.on("data",(chunk)=>{
            result+=chunk
        })
        res.on("end",()=>{
            const $=cheerio.load(result)
            let titlelist=[]
            let contentlist=[]
            let authorlist=[]
            let titlenodelist=$("body > div.main3 > div.left > div.sons > div.cont > p:nth-child(2) > a > b")
            let contentnodelist=$('body > div.main3 > div.left > div.sons > div.cont > div.contson')
            let authornodelist=$("body > div.main3 > div.left > div.sons > div.cont > p.source")
            for(let i=0;i<titlenodelist.length;i++){
                titlelist.push(titlenodelist.eq(i).text())
                authorlist.push(authornodelist.eq(i).text())
                contentlist.push(contentnodelist.eq(i).text())
            }
            console.log(titlelist.length,authorlist.length,contentlist.length)
            for(let i=0;i<titlelist.length;i++){
                fs.writeFileSync('./article/'+authorlist[0]+'.txt',titlelist[i]+'\r',{flag:'a'})
                fs.writeFileSync('./article/'+authorlist[0]+'.txt',authorlist[i]+'\r',{flag:'a'})
                fs.writeFileSync('./article/'+authorlist[0]+'.txt',contentlist[i]+'\r\r',{flag:'a'})
            }
            resolve()
        })
    })
    })
}
```

è¿™ä¸€æ­¥å®Œæˆä¹‹åï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ä½œè€…è¯—æ­Œé¡µçš„é¡µç å¯ä»¥é€šè¿‡æ„é€ urlè·å¾—ï¼Œé¦–é¡µçš„urlä¸º`https://so.gushiwen.org/authors/authorvsw_b90660e3e492A1.aspx`,å…¶ä¸­çš„`A1`è¡¨ç¤ºç¬¬ä¸€é¡µï¼Œåé¢ç›´æ¥æ‰‹åŠ¨æ›¿æ¢å³å¯ç¿»é¡µã€‚ä¸‹é¢ç›´æ¥å†™å…¥æ‰€æœ‰
```javascript
function writeAll(){
    getAllAuthor().then(res=>{
        res.forEach(async (item,index)=>{
            for(let i=0;i<10;i++){
                await writeContent(item.replace('A1','A'+(i+1)))
            }
        })
    })
}
```
æœ€ååªéœ€è¦æ‰§è¡Œä¸€ä¸‹`writeAll`å‡½æ•°ï¼Œå¤§åŠŸå‘Šæˆï¼