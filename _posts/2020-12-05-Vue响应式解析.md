---
layout: post
title: "Vueå“åº”å¼è§£æ"
date: 2020-12-05
sitemap: false
keywords: "blog"
description: "ğŸš€"
---

vueå“åº”å¼ç³»ç»Ÿè§£æ

# vueçš„æ‰§è¡Œè¿‡ç¨‹

> 1.new Vueä¹‹ååˆå§‹åŒ–å£°æ˜å‘¨æœŸå‡½æ•°ï¼Œpropsï¼Œäº‹ä»¶ï¼Œdataï¼Œcomputedï¼Œwatcherç­‰ï¼Œåœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¹dataé‡Œçš„å±æ€§é€’å½’å¼è¿›è¡Œå“åº”å¼å¤„ç†ã€‚  
> 2.å¦‚æœæ˜¯è¿è¡Œæ—¶ç¼–è¯‘ï¼Œå­˜åœ¨templateæ¨¡æ¿ï¼Œåˆ™ä¼šå¯¹å¯¹åº”parseï¼Œoptimizeï¼Œgenerateä¸‰ä¸ªé˜¶æ®µã€‚parseè§£ææ¨¡æ¿å­—ç¬¦ä¸²ï¼Œoptimizeæ ‡è®°é™æ€èŠ‚ç‚¹ï¼ˆä¼˜åŒ–diffè¿‡ç¨‹ï¼‰ï¼Œgenerateç”Ÿæˆrender functionã€‚  
> 3.render functionæ¸²æŸ“åˆ°è§†å›¾çš„æ—¶å€™ï¼Œä¼šè§¦å‘æ•°æ®çš„gettteræ¥è¿›è¡Œä¾èµ–æ”¶é›†ï¼Œå°†ç›¸åº”çš„watcheræ”¾è¿›Depä¾èµ–åˆ—è¡¨é‡Œã€‚ä¿®æ”¹æ•°æ®çš„æ—¶å€™ï¼Œä¼šè§¦å‘setteræ¥æ‰§è¡Œä¾èµ–åˆ—è¡¨é‡Œçš„watcherå¯¹åº”æ–¹æ³•æ¥æ›´æ–°è§†å›¾ã€‚æ›´æ–°å‰ä¼šè¿›è¡Œå‰åvDomå¯¹æ¯”ï¼Œpatchï¼Œæœ€ååªæ›´æ–°éœ€è¦æ›´æ–°çš„åœ°æ–¹


```javascript
function defineReactive(obj,key,val){
    let dep=new Dep()
    Object.defineProperty(obj,key,{
        configurable:true,//å¯ä»¥è‡ªå®šä¹‰getå’Œset
        enumerable:true,//å¯ä»¥è¢«éå†
        get(){
            dep.addSub(Dep.target)
            return val
        },
        set(newVal){
            if(newVal===val) return
            dep.notify()
        }
    })
}

//å¯¹æ•´ä¸ªå¯¹è±¡è¿›è¡Œå“åº”å¼å¤„ç†ï¼Œé€’å½’çš„æƒ…å†µæ²¡æœ‰åŒ…å«
function observe(obj){
    Object.keys(obj).forEach(key=>{
        defineReactive(obj,key,obj[key])
    })
}

//è®¢é˜…è€…
class Watcher{
    constructor(){
        //å°†Dep.targetæŒ‡å‘å½“å‰çš„watcherå¯¹è±¡
        Dep.target=this
    }
    update(){
        console.log('view has been updated')
    }
}
//å‘å¸ƒè€…
class Dep{
    target=null
    constructor(){
        this.subs=[]
    }
    addSub(watcher){
        this.subs.push(watcher)
    }
    notify(){
        this.subs.forEach(watcher=>{
            watcher.update()
        })
    }
}

class Vue{
    constructor(options){
        this._data=options.data
        observe(this._data)
        //å°†Dep.targetæŒ‡å‘è¯¥å¯¹è±¡
        new Watcher()
        //æ¨¡æ‹Ÿgetterä¾èµ–æ”¶é›†
        console.log('render~',this._data.x)
        console.log('render~',this._data.y)
    }
}

let testdata={x:1,y:2}

new Vue({
    data:testdata
})
//æ¨¡æ‹Ÿsetteré€šçŸ¥watcheræ›´æ–°è§†å›¾
testdata.x=3
testdata.y=4

// render~ 1
// render~ 2
// view has been updated
// view has been updated
```